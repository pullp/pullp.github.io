---
layout:     post
title:      虚拟机相关操作记录
subtitle:   vmware, virtual box
date:       2020-09-30
author:     wxk1997
header-img: img/default-bg.png
catalog: true
tags:
    - 虚拟机
---

# 1. 前言

记录一些安装虚拟机过程中遇到的问题, 便于再次用到时查阅.

## 1.1. 更新历史

| 更新时间  | 更新内容  |
|  ----     | ----      |
| 2020-09-30 | 初稿     |
| 2020-10-04 | npm使用淘宝源     |
| 2020-10-07 | 编译tmux     |
| 2020-11-07 | github clone 加速器     |
| 2020-11-08 | pypi清华源使用方法     |

# 2. 正文

## 2.1. vmware 相关

### 2.1.1. `重新安装vmware tools` 选项灰色解决方案

先关机

```
sudo shutdown now 
```

然后如下操作

```
虚拟机->设置->CD/DVD->使用物理驱动器 && 自动检测
```

具体步骤参考[1]

***上面这种方法可能失败, 还可以使用下面这种方法***


```
虚拟机->设置->CD/DVD->使用ISO镜像文件(选择vmware安装文件夹下的 VMware Workstation\linux.iso)
```

然后将`cdrom`连接到虚拟机上(右下角有光盘图标)


### 2.1.2. server 版安装 vmware tools

参考[2]

首先保证 包含`vmware tools`的镜像(VMware Workstation\linux.iso)连接到虚拟机中. 设备名通常为 `/dev/cdrom`

我们先将`cdrom`挂载到文件系统中

```
mkdir /mnt/cdrom
mount /dev/cdrom /mnt/cdrom
```

然后将`vmware tools`安装包拷贝出来, 并`umount` 挂载文件夹

```
cp /mnt/cdrom/VMwareTools-10.3.21-14772444.tar.gz ~/
umount /mnt/cdrom
```

最后解压安装即可

```
cd ~
tar xvf ./VMwareTools-10.3.21-14772444.tar.gz
cd vmware-tools-distrib
./vmware-install.pl -d
```

### 2.1.3. 共享文件夹相关

手动挂载共享文件夹

```
sudo vmhgfs-fuse .host:/ /mnt/hgfs -o allow_other
```

## 2.2. virtual box 相关

todo


## 2.3. ubuntu 相关

### 2.3.1. 安装ruby

`ruby` 有多个版本, `ubuntu 16.04` 默认用 `apt` 安装的 `ruby` 可能版本较低, 无法安装 `seccomp-tools` 等工具, 因此需要想办法安装高版本的 `ruby`.

具体命令如下:

```
sudo apt-add-repository ppa:brightbox/ruby-ng 
sudo apt install ruby2.7 ruby2.7-dev
```

[4]中提到了另一种方式, 使用 `snap`. 但是在 `ubuntu 16.04.7` 上安装成功之后并不能执行`ruby`, 不清楚具体原因.

### 2.3.2. 各种代理设置

全局代理, 参考[3].

```
vim ~/.zshrc
export proxy="socks5://host:port"
export http_proxy=$proxy
export https_proxy=$proxy
export ftp_proxy=$proxy
```

#### 2.3.2.1. github

设置http代理:

```
git config --global http.proxy http://host:port &&\
git config --global https.proxy https://host:port
```

设置socks5代理:

```
git config --global http.proxy 'socks5://host:port' && \
git config --global https.proxy 'socks5://host:port'
```

查看设置结果:

```
git config --global --get-all http.proxy && \
git config --global --get-all https.proxy
```

取消代理:

```
git config --global --unset http.proxy &&\
git config --global --unset https.proxy
```

使用clone加速器(感谢航神推荐orz):


```
github.com.cnpmjs.org
gitclone.com
```

使用方法很简单, clone的时候替换掉 `github.com`即可.

#### 2.3.2.2. pip

*建议使用阿里云/清华的源*

设置代理:

```
pip install -r requirements.txt --proxy=代理服务器IP:端口号
```

使用阿里云源:

```bash
mkdir ~/.pip
cat > ~/.pip/pip.conf << EOF

[global]

trusted-host=mirrors.aliyun.com

index-url=http://mirrors.aliyun.com/pypi/simple/

EOF
```

临时安装使用阿里云的源:

```bash
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pwntools
```


清华源使用参考: 

[pypi 镜像使用帮助 - 清华大学开源软件镜像站](https://mirrors.tuna.tsinghua.edu.cn/help/pypi/)

临时使用

```
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple some-package
```

设为默认:

升级 pip 到最新的版本 (>=10.0.0) 后进行配置：

```
pip install pip -U
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

如果您到 pip 默认源的网络连接较差，临时使用本镜像站来升级 pip：

```
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pip -U
```

#### 2.3.2.3. Anaconda

详见[Anaconda常用操作#设置代理](https://pullp.github.io/2020/08/13/3-Anaconda_cheetsheet/#%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86)



#### 2.3.2.4. npm

使用淘宝源:

```bash
# 临时
npm install 软件名 --registry https://registry.npm.taobao.org 
#永久
npm config set registry https://registry.npm.taobao.org
#验证
npm config get registry
```

#### 2.3.2.5. docker

安装:

```bash
sudo apt install docker.io  
```

使用阿里云加速参考: https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors



### 2.3.3. 编译相关

#### 2.3.3.1. 编译 tmux

官方仓库: https://github.com/tmux/tmux

```bash
git clone https://github.com/tmux/tmux.git
cd tmux
sh autogen.sh
./configure && make
```

需要安装一些依赖

```
sudo apt install libevent-dev ncurses-dev -y
```

### 更新相关

一条指令更新+升级(来自航神orz)

```bash
apt update && apt upgrade -y && apt dist-upgrade -y && apt clean -y && apt autoclean -y && apt remove -y && apt autoremove -y
```

# 3. 结语


> "这个`wsl`就是逊啦. 动不动就出bug, 快照功能也没有."


# 4. 参考

1. [解决虚拟机VMWareTools图标灰色问题](https://blog.csdn.net/weixin_41913844/article/details/84327042)
2. [在Ubuntu Server 16.04 LTS下安装VMware Tools](https://www.cnblogs.com/KKSoft/p/7765195.html)
3. [Linux/CentOS设置全局代理（http）](https://www.cnblogs.com/EasonJim/p/9826681.html)
4. [如何在ubuntu 16.04中安装ruby>=2.4.4](https://askubuntu.com/questions/1175693/how-to-upgrade-ruby-to-version-2-4-4-on-ubuntu-16-04-for-wpscan)